# CTF平台系统架构总览

## 1. 系统概述

CTF（Capture The Flag）平台是一个完整的网络安全竞赛系统，提供题目管理、用户认证、Flag提交、排行榜和后台管理等功能。系统采用前后端分离架构，提供RESTful API接口。

## 2. 技术栈

### 后端技术栈

- **Web框架**: Flask 2.3.3 (Python)
- **数据库**: MySQL + SQLAlchemy ORM
- **认证**: JWT (JSON Web Tokens)
- **缓存**: Redis (可选)
- **文件存储**: 本地文件系统
- **API文档**: Swagger UI

### 前端技术栈

- **框架**: 原生JavaScript + Bootstrap 5
- **样式**: CSS3 + Bootstrap CSS
- **图标**: Font Awesome
- **HTTP客户端**: Fetch API
- **状态管理**: localStorage + Session管理

### 开发工具

- **代码格式化**: Black
- **代码检查**: Flake8
- **测试**: Pytest + pytest-flask
- **环境管理**: python-dotenv

## 3. 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     客户端 (浏览器)                           │
└────────────────────────────┬────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                     Nginx/Web服务器                          │
└────────────────────────────┬────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                    Flask应用服务器                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │ 认证模块  │  │ 题目模块  │  │ 提交模块  │  │ 管理模块  │    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘    │
└───────────────────────┬─────────────────────────────────────┘
                        │
        ┌───────────────┼───────────────┐
        ▼               ▼               ▼
┌───────────────┐ ┌───────────────┐ ┌───────────────┐
│   MySQL数据库  │ │    Redis缓存   │ │  文件存储系统  │
└───────────────┘ └───────────────┘ └───────────────┘
```

## 4. 核心模块

### 4.1 用户认证与权限

- **用户注册/登录**: JWT令牌认证
- **权限分级**: 普通用户、管理员
- **会话管理**: Token自动刷新

### 4.2 题目管理系统

- **题目分类**: Web、Pwn、Reverse、Crypto、Misc、Forensics
- **难度分级**: 简单、中等、困难、专家
- **计分系统**: 动态分数 + 一血奖励
- **附件管理**: 文件上传与下载

### 4.3 提交与验证系统

- **Flag验证**: 支持静态/动态Flag
- **提交记录**: 用户解题历史
- **重复提交检查**: 防止重复得分

### 4.4 排行榜系统

- **全球排行榜**: 总积分排名
- **分类排行榜**: 按题目类型排名
- **解题时间榜**: 按解题时间排序

### 4.5 后台管理系统

- **用户管理**: 用户信息维护
- **题目管理**: 题目CRUD操作
- **分类管理**: 题目分类维护
- **数据统计**: 平台运营数据

## 5. 数据流设计

### 5.1 用户认证流程

![deepseek_mermaid_20251218_fd963e](docs/images/uml/deepseek_mermaid_20251218_fd963e.png)

### 5.2 Flag提交流程

![deepseek_mermaid_20251218_02ccee](docs/images/uml/deepseek_mermaid_20251218_02ccee.png)

## 6. 安全架构

### 6.1 认证安全

- JWT令牌签名验证
- Token过期机制
- 密码哈希存储 (bcrypt)
- 请求频率限制

### 6.2 数据安全

- SQL注入防护 (ORM)
- XSS防护 (输入转义)
- 文件上传验证
- 敏感信息加密

### 6.3 操作安全

- 管理员操作审计
- 用户行为日志
- 异常检测与告警

## 7. 性能设计

### 7.1 数据库优化

- 索引优化
- 查询缓存
- 连接池管理
- 读写分离（可选）

### 7.2 应用层优化

- 请求缓存 (Redis)
- 静态文件CDN
- 异步任务处理
- 负载均衡

### 7.3 前端优化

- 资源压缩与合并
- 图片懒加载
- 客户端缓存
- 按需加载

## 8. 扩展性设计

### 8.1 水平扩展

- 无状态服务设计
- 数据库分片策略
- 负载均衡支持
- 分布式缓存

### 8.2 功能扩展

- 插件化架构
- WebHook支持
- API版本管理
- 第三方集成

## 9. 监控与运维

### 9.1 系统监控

- 应用性能监控
- 数据库监控
- 服务器资源监控
- 错误日志收集

### 9.2 告警系统

- 异常告警
- 性能阈值告警
- 安全事件告警
- 业务指标告警

## 10. 部署架构

### 10.1 环境划分

- **开发环境**: 本地开发环境
- **测试环境**: 功能测试环境
- **生产环境**: 线上运行环境

### 10.2 部署策略

- 自动化部署脚本
- 数据库迁移管理
- 回滚机制
- 备份策略

**架构特点总结**：

1. **前后端分离**: 清晰的API边界，便于独立开发和部署
2. **模块化设计**: 功能模块解耦，易于维护和扩展
3. **安全优先**: 多层次安全防护机制
4. **性能优化**: 多级缓存和数据库优化
5. **可扩展性**: 支持水平扩展和功能插件化
6. **易于部署**: 支持传统部署方式，无需容器化依赖