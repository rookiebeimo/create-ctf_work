# 2. 选择MySQL而非PostgreSQL作为数据库

*   日期: 2025-10250
*   决策者: @杨鹏祥（运维工程师）, @林文进（后端工程师）, @宋礼雄（测试工程师）

## 上下文与问题陈述

CTF平台需要一个稳定、可靠的关系型数据库来存储：

1. 用户信息和认证数据
2. 题目、分类和Flag数据
3. 提交记录和积分数据
4. 系统日志和操作记录

项目环境约束：

- Windows服务器环境
- 团队对数据库的运维经验有限
- 预算有限，需要免费的数据库解决方案
- 需要良好的工具支持和社区资源

## 决策因素

*   **团队经验**：团队成员对数据库的熟悉程度
*   **运维成本**：Windows环境下的安装、配置和维护难度
*   **性能需求**：CTF平台的读写模式（读多写少，高峰期间写入密集）
*   **工具生态**：GUI管理工具、备份工具、监控工具的可获得性
*   **社区支持**：遇到问题时能够获得的帮助资源
*   **兼容性**：与Flask框架和Python生态的兼容性
*   **扩展性**：未来可能的扩展需求（分库分表、读写分离等）

## 考虑的方案

### 方案 A：使用MySQL

- 成熟稳定的关系型数据库
- 优秀的Windows支持
- 丰富的GUI工具（如MySQL Workbench）
- 广泛的社区支持和文档资源
- 与Flask-SQLAlchemy良好集成
- 开源免费（社区版）

### 方案 B：使用PostgreSQL

- 功能更丰富的开源数据库
- 更好的SQL标准兼容性
- 强大的复杂查询能力
- 优秀的并发处理能力
- 丰富的扩展功能
- 开源免费

### 方案 C：使用SQLite（仅开发环境）

- 零配置，单文件数据库
- 适合开发和测试
- 无需服务器进程
- 性能有限，不适合生产环境

## 决策结果

选择**方案A（MySQL）**，原因如下：

1. **Windows环境友好**：
   - MySQL在Windows上的安装和配置非常简单
   - 有成熟的Windows安装程序（MySQL Installer）
   - Windows服务的集成良好
   - 运维工程师杨鹏祥在Windows环境下有丰富的MySQL运维经验

2. **团队技能匹配**：
   - 后端工程师林文进熟悉MySQL的开发和优化
   - 测试工程师宋礼雄了解MySQL的性能测试和基准测试
   - 渗透工程师刘城铭熟悉MySQL的安全配置和审计
   - 团队整体对MySQL的掌握程度高于PostgreSQL

3. **工具生态系统**：
   - MySQL Workbench提供完整的数据库管理功能
   - 多种备份和恢复工具可用
   - 监控工具（如MySQL Enterprise Monitor社区版）便于性能监控
   - 与现有技术栈（Python、Flask）集成成熟

4. **CTF业务特点**：
   - CTF平台的数据模型相对简单，不需要PostgreSQL的高级功能
   - 读写模式主要是：频繁的读取（题目列表、排行榜）和批量写入（提交记录）
   - MySQL的MyISAM和InnoDB引擎可以满足不同表的需求
   - 积分计算等业务逻辑更适合在应用层实现，而非数据库层

5. **部署和维护成本**：
   - MySQL的维护成本较低，特别是在Windows环境下
   - 备份和恢复操作简单直接
   - 故障排查工具和文档丰富
   - 社区活跃，问题解决速度快

6. **性能和扩展性**：
   - MySQL 8.0的性能已经足够满足CTF平台需求
   - 支持读写分离、主从复制等扩展方案
   - 对于预计的1000并发用户，MySQL完全可以胜任

## 后果

### 积极后果 ✅

1. **快速部署**：在Windows服务器上30分钟内完成MySQL的安装和配置。
2. **运维简化**：
   - 使用MySQL Workbench进行可视化管理
   - Windows计划任务实现自动备份
   - 性能监控工具集成简单
3. **开发效率**：
   - Flask-SQLAlchemy与MySQL集成顺畅
   - 数据库迁移工具（Flask-Migrate）工作正常
   - 开发环境可以使用MySQL或SQLite，灵活切换
4. **稳定性**：
   - MySQL 8.0运行稳定，未出现数据库相关故障
   - 备份和恢复流程验证有效
5. **成本控制**：
   - 完全免费（社区版）
   - 硬件资源消耗合理

### 消极后果 ❌

1. **功能限制**：
   - 缺乏PostgreSQL的一些高级功能（如窗口函数、JSONB类型）
   - 全文搜索功能不如PostgreSQL强大
2. **复杂查询性能**：
   - 某些复杂查询（如多层嵌套子查询）性能一般
   - 需要更仔细的索引设计和查询优化
3. **数据一致性**：
   - 默认的隔离级别和锁机制可能需要特别注意
   - 在高并发写入时需要合理设计事务
4. **扩展性担忧**：
   - 如果用户量大幅增长，可能需要更早考虑分库分表
   - 垂直扩展（增加服务器资源）成本可能较高

### 缓解措施

1. **性能优化**：

   ```sql
   -- 针对CTF平台的优化配置
   [mysqld]
   innodb_buffer_pool_size = 1G
   innodb_log_file_size = 256M
   query_cache_size = 128M
   max_connections = 200
   thread_cache_size = 50
   ```